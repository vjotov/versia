<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type"><title>Chapter 5. Building Software with ClearCase</title><meta name="generator" content="DocBook XSL Stylesheets V1.49"><meta name="generator" content="SGI XSL DocBook Customization Stylesheets V1.0"><link rel="home" href="index.html" title="CASEVision&#8482;/ClearCase
Concepts Guide"><link rel="up" href="index.html" title="CASEVision&#8482;/ClearCase
Concepts Guide"><link rel="previous" href="ch04.html" title="Chapter 4. ClearCase Views"><link rel="next" href="ch06.html" title="Chapter 6. ClearCase Process Control"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 5. Building Software with ClearCase</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04.html" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch04.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch06.html" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch06.html">Next</a></td></tr></table><hr></div><!--CONTENT_BEGIN--><div class="chapter"><div class="titlepage"><div><h2 class="title"><a name="id5444884"></a>Chapter 5. <a name="id82423"></a>Building Software with ClearCase</h2></div></div>
<p>ClearCase provides a software build environment closely resembling that of the &#8220;traditional&#8221; <a name="idch5build2"></a><i>make</i>(1) program. <i>make</i> was originally developed for UNIX systems, and has since been ported to other operating systems. When building software systems with ClearCase-controlled data, developers can use their hosts' native <i>make</i> programs, their organization's home-grown shell scripts, or third-party build utilities.</p>
<p>ClearCase includes its own build utility, <i>clearmake</i>, with many features not supported by other build programs:</p>
<div class="itemizedlist"><ul type="disc"><li><p><a name="idch5build3"></a><i>build auditing</i>, with automatic detection of source dependencies, including header file dependencies</p>
</li>
<li><p>automatic creation of permanent &#8220;bill-of-materials&#8221; documentation of the build process and its results<a name="idch5build4"></a></p>
</li>
<li><p>sophisticated build-avoidance algorithms, guaranteeing correct results when building in a parallel development environment<a name="idch5build5"></a></p>
</li>
<li><p>sharing of binaries among users' views, saving both time and disk storage</p>
</li>
<li><p>parallel and distributed building, applying the resources of multiple processors and/or multiple hosts to builds of large software systems<a name="idch5build6"></a></p>
</li>
</ul></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5445058"></a><a name="id90595"></a>Overview</h2></div></div>
<p>Users perform builds (along with all other ClearCase-related work) in <a name="idch5build7"></a><i>views</i>. Typically, users work in separate, private views; sometimes, a group shares a single view &#8212; for example, during a software integration period.</p>
<p>As described in <a href="ch04.html#id76462" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch04.html#id76462">Chapter 4, &#8220;ClearCase Views,&#8221;</a> each view provides a complete environment for building software, including:</p>
<div class="itemizedlist"><ul type="disc"><li><p>a particular configuration of source versions</p>
</li>
<li><p>a private workspace in which the user(s) can modify source files, and can use build tools to create object modules, executables, and so on</p>
</li>
</ul></div><p>As a build environment, each view is &#8220;semi-isolated&#8221; from other views. Building software in one view can never <i>disturb</i> the work in another view &#8212; even another build of the same program taking place at the same time. But a user can examine and <span class="emphasis"><i>benefit</i></span> from work previously performed in another view. A new build automatically shares files created by past builds, when appropriate. This saves the time and disk space involved in building new objects that duplicate existing ones.</p>
<p>The user can (but need not) determine what other builds have taken place in a directory, across all views. ClearCase includes tools for listing and comparing past builds.<a name="idch5build8"></a></p>
<p>The key to this scheme is the fact that the development team's VOBs constitute a globally-accessible repository for files created by builds &#8212; the same role they play for the source files that go into builds. A sharable file produced by a software build is termed a <a name="idch5build9"></a><i>derived object</i> (<i>DO</i>). Associated with each derived object is a <i>configuration record</i> (<i>CR</i>), which <i>clearmake</i> can use during subsequent builds to decide whether or not the DO can be reused or shared.</p>
<p><a href="ch05.html#id27418" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id27418">Figure 5-1</a> illustrates the ClearCase software build scheme.</p>
<p><div class="figure"><p><a name="id5445256"></a><b>Figure 5-1. <a name="id27418"></a>Building Software with ClearCase: Isolation and Sharing</b></p>
<div class="mediaobject"><img src="Fig5-1.gif" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/figures/Fig5-1.gif"></div></div><br>
</p>
<p>The next section describes the way in which ClearCase keeps track of the objects produced by software builds. Later, in <a href="ch05.html#id68240" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id68240">&#8220;Build Avoidance&#8221;</a>, we describe the mechanism that enables such objects to be shared among views.</p>
</div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5445294"></a><a name="id69638"></a>Dependency Tracking - MVFS and Non-MVFS Files</h2></div></div>
<p>During build script execution, a host's <a name="idch5build10"></a><i>MVFS</i> (<i>multiversion file system</i>) automatically <i>audits</i> low-level system calls performed on ClearCase data: <i>create</i>, <i>open</i>, <i>read</i>, and so on. Calls involving these objects are monitored:</p>
<div class="itemizedlist"><ul type="disc"><li><p>versions of elements used as build input</p>
</li>
<li><p>view-private files used as build input &#8212; for example, the checked-out version of a file element</p>
</li>
<li><p>files created within VOB directories during the build</p>
</li>
</ul></div><p>Note that some of these objects are actually located in VOB storage, and others in view storage. The view combines them into a <a name="idch5build11"></a><i>virtual workspace</i>, where they all <i>appear</i> to be located in VOB directories. They are termed <i>MVFS files </i>and <i>MVFS directories</i>, because they are accessed through the MVFS.</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5445394"></a>Automatic Detection of MVFS Dependencies</h3></div></div>
<p>Since auditing of MVFS files is completely automatic, users need not keep track of exactly which files are being used in builds &#8212; that's ClearCase's job. For example, ClearCase determines exactly which C-language source files referenced with <a name="idch5build12"></a><tt>#include </tt>directives are used in a build. This eliminates the need to declare such files in the makefile, and eliminates the need for dependency-detection tools, such as <i>makedepend</i>.</p>
</div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5445447"></a>Tracking of Non-MVFS Files</h3></div></div>
<p>A build can also involve files that are <a name="idch5build13"></a><span class="emphasis"><i>not</i></span> accessed through VOB directories. Such <i>non-MVFS files</i> are not audited automatically, but are tracked &#8220;on request&#8221; (by being declared as dependencies in a makefile). This enables auditing of build tools that are not stored as ClearCase elements (for example, a C-language compiler), flag files in the user's home directory, and so on. Tracking information on a non-MVFS file includes its time-modified stamp, size, and checksum.</p>
</div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5445487"></a><a name="id24733"></a>Derived Objects and Configuration Records</h2></div></div>
<p>When it finishes executing a build script, ClearCase records the results, including build audit information, in the form of derived objects and configuration records.<a name="idch5build14"></a></p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5445508"></a>Derived Objects (DOs)</h3></div></div>
<p>For each new MVFS file (pathname within a VOB) created during a build, ClearCase creates a corresponding object in the VOB database. Together, the file and the database object constitute a <a name="idch5build15"></a><a name="idch5build16"></a><i>derived object</i>, or <i>DO</i>.</p>
<div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5445564"></a>Sibling Derived Objects</h4></div></div>
<p>All the derived objects created by execution of a build script have equal status, even though some of them might be explicit build targets, and others might be created as &#8220;side effects&#8221; (for example, compiler listing files). The term <a name="idch5build17"></a><i>siblings</i> describes a group of DOs created by the same script. Siblings &#8220;travel together&#8221; &#8212; whenever a DO becomes shared among views, all its siblings become shared, too.</p>
</div><div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5445596"></a>Derived Object Identifiers (DO-IDs)</h4></div></div>
<p>A derived object is automatically assigned a unique identifier, its <a name="idch5build18"></a><i>DO-ID</i>; this enables users to access any derived object with an extended pathname (<a href="ch05.html#id80453" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id80453">Figure 5-2</a>).</p>
<p><div class="figure"><p><a name="id5445625"></a><b>Figure 5-2. <a name="id80453"></a>Extended Pathname of a Derived Object &#8212; DO-ID</b></p>
<div class="mediaobject"><img src="Fig5-2.gif" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/figures/Fig5-2.gif"></div></div><br>
</p>
<p>A derived object's <i>DO-ID</i> is analogous to a version's <i>version-ID</i>: it is unique, globally accessible, and view-independent; it distinguishes a particular object in the VOB database from others that share the same file system pathname.</p>
<p>As development progresses, many DOs will be created at the same pathname, by builds performed in different views, and by rebuilds within a given view. But no name collisions occur, because each derived object has its own DO-ID.</p>
<p>For the most part, users need not be concerned with DO-IDs; they can use a derived object's standard pathname when working in the view where it was built (or any other view that shares it):<a name="idch5build19"></a></p>
<div class="itemizedlist"><ul type="disc"><li><p>To standard software &#8212; for example, linkers and debuggers &#8212; the standard pathname of a derived object (<tt>util.o</tt>) references the data file.</p>
</li>
<li><p>To ClearCase commands, the same standard pathname references the VOB database object &#8212; for example, to access the contents of the associated configuration record.</p>
</li>
</ul></div><p>Thisis another instance of ClearCase's transparency feature (see <a href="ch04.html#id91998" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch04.html#id91998">&#8220;Transparency and Its Alternatives&#8221;</a>): a standard pathname accesses one of many different variants of a file system object. Note this distinction, however:</p>
<div class="itemizedlist"><ul type="disc"><li><p>A version of an element appears in a view by virtue of having been selected by a config spec rule.</p>
</li>
<li><p>A particular derived object appears in a view as the result of a ClearCase build.</p>
</li>
</ul></div></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5445769"></a>Configuration Records (CRs)</h3></div></div>
<p>For each build script it executes, <a name="idch5build20"></a><a name="idch5build21"></a><a name="idch5build22"></a><i>clearmake</i> creates a <i>configuration record</i>, or <i>CR</i>, that is permanently associated with the newly-built derived objects. Each CR documents both the &#8220;bill of materials&#8221; and the &#8220;assembly procedure&#8221; for a set of sibling DOs.</p>
<p>Users can examine CRs to see a wealth of information:<a name="idch5build23"></a></p>
<div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><b>Input files<a name="idch5build24"></a></b></span> &#8212; Identifiers for objects used as build input: <i>version-IDs</i> (for versions of elements); <i>DO-IDs</i> (for derived objects created as subtargets); timestamps (for view-private files and for each non-MVFS file explicitly declared as a dependency in the makefile)</p>
</li>
<li><p><span class="bold"><b>Output files<a name="idch5build25"></a></b></span> &#8212; The pathname and DO-ID of each derived object created during the build (all the <i>siblings</i>)</p>
</li>
<li><p><span class="bold"><b>Build procedure<a name="idch5build26"></a></b></span> &#8212; The text of the <i>makefile</i>'s build script, including expansions of all make macros</p>
</li>
<li><p><span class="bold"><b>General data<a name="idch5build27"></a></b></span> &#8212; The user who performed the build; the host used to execute the build script; the view in which the build took place; the date and time at which build script execution started</p>
</li>
</ul></div></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5445965"></a>Operations Involving DOs and CRs</h3></div></div>
<p>ClearCase includes commands for working with derived objects and configuration records:</p>
<div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><b>DO listing<a name="idch5build28"></a></b></span> &#8212; A user can list all the DOs created at a particular pathname, across all views:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">
% cleartool lsdo -long util.o
14-Mar-94.17:50:49     Allison K. Pak (akp.users@neptune)
create derived object &quot;util.o@@14-Mar.17:50.331&quot;
references: 1  =&gt; neptune:/usr/akp/tut/tut.vws
14-Mar-94.17:48:40     Allison K. Pak (akp.users@neptune)
create derived object &quot;util.o@@14-Mar.17:48.260&quot;
references: 1  =&gt; neptune:/usr/akp/tut/fix.vws
14-Mar-94.17:45:42     Allison K. Pak (akp.users@neptune)
create derived object &quot;util.o@@14-Mar.17:45.215&quot;
references: 1  =&gt; neptune:/usr/akp/tut/old.vws
</pre></td></tr></table><br></li>
<li><p><span class="bold"><b>CR display<a name="idch5build29"></a></b></span> &#8212; A user can display the contents of an individual CR:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">
% cleartool catcr util.o@@14-Mar.17:48.260
Target util.o built by akp.users
Host &quot;neptune&quot; running HP-UX A.09.01 (9000/715)
Reference Time 14-Mar-94.17:48:35, this audit started
14-Mar-94.17:48:37
View was neptune:/usr/akp/tut/fix.vws
Initial working directory was /tmp/akp_neptune_hw/src
----------------------------
MVFS objects:
----------------------------
/tmp/akp_neptune_hw/src/hello.h@@/main/1   &lt;20-May-93.14:46:00&gt;
/tmp/akp_neptune_hw/src/util.c@@/main/rel2_bugfix/1 &lt;14-Mar-94.17:48:32&gt;
/tmp/akp_neptune_hw/src/util.o@@14-Mar.17:48.260
----------------------------
Variables and Options:
----------------------------
MKTUT_CC=cc
----------------------------
Build Script:
----------------------------
c -c util.c
----------------------------
</pre></td></tr></table><br></li>
</ul></div><p>ClearCase can also display an entire <i>CR hierarchy</i>, which mirrors the multiple-level structure of a <i>makefile</i>-based build (building a top-level target requires building of several second-level targets, which requires building of some third-level targets, and so on).</p>
<div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><b>CR comparison<a name="idch5build30"></a></b></span> &#8212; ClearCase can use CRs to compare different builds of the same target, showing differences in how the objects were built:</p>
<table bgcolor="#E0E0E0" width="90%" border="1" cellpadding="10"><tr><td><pre class="literallayout">
% cleartool diffcr util.o@@14-Mar.17:48.260 util.o@@14-Mar.17:45.215
&lt; Target util.o built by akp.users
&gt; Target util.o built by akp.users
&lt; Reference Time 14-Mar-94.17:48:35, this audit started
14-Mar-94.17:48:37
&gt; Reference Time 14-Mar-94.17:45:33, this audit started
14-Mar-94.17:45:40
&lt; View was neptune:/usr/akp/tut/fix.vws
[uuid 7033a691.3f8011cd.ae42.08:00:09:41:e6:03]
&gt; View was neptune:/usr/akp/tut/old.vws
[uuid d4a3a27f.3f7f11cd.adce.08:00:09:41:e6:03]
----------------------------
MVFS objects:
----------------------------
&lt; /tmp/akp_neptune_hw/src/util.c@@/main/rel2_bugfix/1
                                           &lt;14-Mar-94.17:48:32&gt;
&gt; /tmp/akp_neptune_hw/src/util.c@@/main/1  &lt;20-May-93.17:05:00&gt;
----------------------------
&lt; /tmp/akp_neptune_hw/src/util.o@@14-Mar.17:48.260
&gt; /tmp/akp_neptune_hw/src/util.o@@14-Mar.17:45.215
</pre></td></tr></table><br></li>
<li><p><span class="bold"><b>Version annotation<a name="idch5build31"></a></b></span> &#8212; A user can annotate some or all the versions listed in a CR (or an entire CR hierarchy) with a particular version label or attribute.</p>
</li>
<li><p><span class="bold"><b>View configuration<a name="idch5build32"></a></b></span> &#8212; A user can configure a view to select exactly the versions that were used to build a particular DO, or set of DOs.</p>
</li>
<li><p><span class="bold"><b>Build management<a name="idch5build33"></a></b></span> &#8212; ClearCase uses DOs and CRs to implement its build-avoidance and derived-object-sharing capabilities.</p>
</li>
</ul></div></div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5446253"></a><a name="id68240"></a>Build Avoidance</h2></div></div>
<p>An essential aspect of <a name="idch5build34"></a><i>makefile</i>-based software building is avoiding unnecessary builds. <i>clearmake</i>'s build-avoidance algorithm, based on the CRs produced by build audits, is more sophisticated than that of other <i>make</i> variants. The standard <i>make</i> timestamp-based algorithm cannot guarantee correct results in a parallel-development environment. An object module's being newer than a particular version of its source file does not guarantee that it was built using that version. In fact, reusing recently-built object modules and executables is likely to be incorrect when a previous release of an application is to be rebuilt from &#8220;old&#8221; sources.</p>
<p><a name="idch5build35"></a><i>clearmake</i>'s build-avoidance algorithm does guarantee correct results. Moreover, <i>clearmake</i> can avoid building a new derived object by reusing an existing one built in any view, not just the user's own view. Thus, a derived object can be <i>shared</i> by any number of views.</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5446326"></a><a name="id64723"></a>Configuration Lookup and Wink-In</h3></div></div>
<p>When requested to update a build target, <a name="idch5build36"></a><i>clearmake</i> first determines whether an existing derived object in the current view qualifies for reuse. If not, <i>clearmake</i> evaluates other existing derived objects that were built at the same pathname.</p>
<p>The process of &#8220;qualifying&#8221; a candidate DO is termed <a name="idch5build37"></a><i>configuration lookup</i>. It involves matching the DO's configuration record against the user's current <i>build configuration</i> (<a href="ch05.html#id39849" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id39849">Figure 5-3</a>):</p>
<div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><b>Files</b></span> &#8212; The version of an element listed in the CR must match the version selected by the user's view; any view-private files or non-MVFS files listed in the CR must also match.</p>
</li>
<li><p><span class="bold"><b>Build procedure</b></span> &#8212; The build script listed in the CR must match the script that will be executed if the target is rebuilt. The scripts are compared with all make macros expanded; thus, a match occurs only if the same build options apply (for example, &#8220;compile for debugging&#8221;).</p>
<p><div class="figure"><p><a name="id5446475"></a><b>Figure 5-3. <a name="id39849"></a>Configuration Lookup</b></p>
<div class="mediaobject"><img src="Fig5-3.gif" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/figures/Fig5-3.gif"></div></div><br>
</p>
</li>
</ul></div><p>The search ends as soon as <i>clearmake</i> finds a DO whose configuration exactly matches the user's current build configuration. In general, a configuration lookup can have these outcomes:</p>
<div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><b>Reuse<a name="idch5build38"></a></b></span> &#8212; If the DO (and its siblings) already in the user's view match the build configuration, <i>clearmake</i> simply keeps them.</p>
</li>
<li><p><span class="bold"><b>Wink-in<a name="idch5build39"></a></b></span> &#8212; If another, previously-built DO matches the build configuration, <i>clearmake</i> causes the DO and its siblings to appear in this view. This operation is termed <i>wink-in</i>.</p>
</li>
<li><p><span class="bold"><b>Rebuild<a name="idch5build40"></a></b></span> &#8212; If configuration lookup fails to find any DO that matches the build configuration, <i>clearmake</i> executes the target's build script. This creates one or more new DOs, and a new CR.</p>
</li>
</ul></div><p>Reuse and wink-in take place only if <i>clearmake</i> determines that a newly-built derived object would be identical to the existing derived object. In general, wink-in takes place when two or more views select some or all of the same versions of source elements. For example, a user might create a &#8220;clone&#8221; view, with exactly the same configuration as an existing view. Initially, the new view sees all the sources, but contains no derived objects. Executing <i>clearmake</i> causes a wink-in of many derived objects from the existing view.</p>
<div class="section"><div class="titlepage"><div><h4 class="title"><a name="id5446650"></a>Hierarchical Builds</h4></div></div>
<p>In a hierarchical build, some objects are built and then used to build others. <a name="idch5build41"></a><i>clearmake</i> performs configuration lookup separately for each target. To ensure a consistent result, it also applies this principle: if a new object is created, then all targets that depend on it must be rebuilt.</p>
</div></div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5446695"></a><a name="id80655"></a>Build Auditing with <span class="emphasis"><i>clearaudit</i></span></h2></div></div>
<p>





Some organizations, or some individual users, may want to use ClearCase build auditing without using the <a name="idch5build42"></a><a name="idch5build43"></a><i>clearmake</i> program. Others may want to audit development activities that do not involve <i>makefiles</i> at all. These users can do their work in an <i>audited shell</i>, a standard shell with build auditing enabled.</p>
<p>For example, a technical writer might produce formatted manual page files by running a shell script that invokes <a name="idch5build44"></a><i>nroff</i>(1). When the script is executed in a shell created by <i>clearaudit</i>, ClearCase creates a single configuration record, recording all the source versions used. All MVFS files read during execution of the audited shell are listed as inputs to the &#8220;build&#8221;. All MVFS files created become derived objects, associated with the single configuration record.</p>
</div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5446792"></a>Storage of DOs and CRs</h2></div></div>
<p>This section discusses the physical storage of derived objects (DOs) and configuration records (CRs). As first discussed in <a name="idch5build45"></a><a href="ch05.html#id24733" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id24733">&#8220;Derived Objects and Configuration Records&#8221;</a>:</p>
<div class="itemizedlist"><ul type="disc"><li><p>A derived object is a compound entity, consisting of both a data file (its <i>data container</i>) and a corresponding VOB database object (which has a unique <i>DO-ID</i>).</p>
</li>
<li><p>Each derived object has an associated configuration record.</p>
</li>
</ul></div><p>When a DO is first built, its data container and CR are placed in the private storage area of the user's view (<a name="idch5build46"></a><a name="idch5build47"></a><a href="ch05.html#id18615" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id18615">Figure 5-4</a>). When the DO becomes shared, through <i>wink-in</i>, its data container and CR migrate to VOB storage. This implements a &#8220;localize the cost&#8221; disk-space allocation scheme: the cost of a derived object used by just one view is borne by that view; the cost of a shared derived object is borne by the VOB, which is a shared resource.</p>
<p><div class="figure"><p><a name="id5446885"></a><b>Figure 5-4. <a name="id18615"></a>Storage of Derived Objects and Configuration Records</b></p>
<div class="mediaobject"><img src="Fig5-4.gif" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/figures/Fig5-4.gif"></div></div><br>
</p>
</div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5446927"></a><span class="emphasis"><i>clearmake</i></span> Compatibility with Other <span class="emphasis"><i>make</i></span> Programs</h2></div></div>
<p>Many <a name="idch5build48"></a><i>make</i> utilities are available in the multiple-architecture, multiple-vendor world of open systems. ClearCase's <i>clearmake</i> utility shares features with many of them, and has some unique features of its own.</p>
<p>Users can adjust <i>clearmake</i>'s level of compatibility with other <i>make</i> programs:</p>
<div class="itemizedlist"><ul type="disc"><li><p><a name="idch5build49"></a><span class="bold"><b>Suppressing</b></span> <i>clearmake</i><span class="bold"><b>'s </b></span><a name="idch5build50"></a><span class="bold"><b>special features</b></span> &#8212; Command options can selectively turn off such features as wink-in, comparison of build scripts, comparison of automatically-detected dependencies, and creation of DOs and CRs. Configuration lookup can be turned off altogether, so that the standard timestamp-based algorithm is used for build avoidance.</p>
</li>
<li><p><span class="bold"><b>Enabling features of other</b></span> <i>make</i> <span class="bold"><b>programs</b></span> &#8212; <i>clearmake</i> has several compatibility modes, which provide for partial emulations of popular <i>make</i> programs, such as Gnu Make and Sun Make.</p>
</li>
</ul></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5447079"></a>Using Another <i>make</i> Instead of <i>clearmake</i></h3></div></div>
<p>Users can achieve absolute compatibility with other <a name="idch5build51"></a><i>make</i> programs by actually using those programs to perform builds. But in a build with a &#8220;standard&#8221; <i>make</i>, there is no build auditing, no configuration lookup, and no sharing of DOs. The MVFS files created by the build are simply view-private files, not derived objects (unless the <i>make</i> program is executed in a <i>clearaudit</i> shell).</p>
</div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5447123"></a>Parallel and Distributed Building</h2></div></div>
<p><a name="idch5build52"></a><i>clearmake</i> includes support for <i>parallel</i> building (concurrent execution of a set of build scripts), and for <i>distributed</i> building (use of other hosts to execute build scripts). A command option specifies the number of hosts to use; hostnames to use are read from a <i>build hosts</i> file (<a href="ch05.html#id76651" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id76651">Figure 5-5</a>).</p>
<p><div class="figure"><p><a name="id5447183"></a><b>Figure 5-5. <a name="id76651"></a>Parallel and Distributed Building</b></p>
<div class="mediaobject"><img src="Fig5-5.gif" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/figures/Fig5-5.gif"></div></div><br>
</p>
<p>For example, a user might perform a three-way build, all of whose processes execute on a single multiprocessor compute server; an overnight build might be distributed across all the workstations in the local network.</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5447211"></a>The Parallel Build Procedure</h3></div></div>
<p>Before starting a parallel build, <a name="idch5build53"></a><i>clearmake</i> considers each target, determining whether an existing DO can be reused, or an actual build is required. Then, it organizes all the actual build work into a hierarchical master schedule.</p>
<p><a name="idch5build54"></a><i>clearmake</i> then dispatches the build scripts to some or all the hosts listed in the build hosts file. It uses a dynamic load-balancing algorithm that makes best use of the available hosts, preferring lightly-loaded hosts to ones that are relatively busy. Access to a &#8220;build server&#8221; host can be restricted to particular times, to particular users working on particular remote hosts, and so on.</p>
<p>Execution of build scripts is managed on each remote host by the <a name="idch5build55"></a><i>ClearCase</i> <i>audited build executor</i> (<i>abe</i>), which is invoked through standard remote-shell facilities.</p>
</div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5447305"></a><a name="id71663"></a>Building on a Non-ClearCase Host</h2></div></div>
<p>Many organizations develop multiple variants of their products, targeted at different platforms. But ClearCase may not currently be available for some of the platforms. How, then, can users build all the required product variants?<a name="idch5build56"></a></p>
<p>One solution is <a name="idch5build57"></a><i>cross-development</i> &#8212; for example, perform a build on a SunOS host that produces executables for the unsupported host. ClearCase provides another solution &#8212; hosts on which ClearCase is not installed can still access ClearCase data, using standard network file-sharing services (such as NFS). This capability is termed <i>non-ClearCase access</i>.</p>
<p>Non-ClearCase access takes advantage of view <a name="idch5build58"></a><i>transparency</i>. Through automatic version-selection, a view makes any VOB appear to be a standard directory tree. Any such &#8220;VOB image&#8221; can be &#8220;exported&#8221; to a non-ClearCase host (<a href="ch05.html#id59970" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch05.html#id59970">Figure 5-6</a>).</p>
<p><div class="figure"><p><a name="id5447407"></a><b>Figure 5-6. <a name="id59970"></a>Non-ClearCase Access</b></p>
<div class="mediaobject"><img src="Fig5-6.gif" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/figures/Fig5-6.gif"></div></div><br>
</p>
<p>Users on the non-ClearCase host can perform builds within these &#8220;VOB image&#8221; directory trees, using native <a name="idch5build59"></a><i>make</i> utilities or other local build tools. The object modules and executables produced by such builds are stored in the view that instantiates the VOB image(s).</p>
<div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5447445"></a>Limitations of Non-ClearCase Access</h3></div></div>
<p>Since ClearCase software is not running on a non-ClearCase host, non-ClearCase access has some limitations. In many cases, there are simple workarounds to the limitations.<a name="idch5build60"></a></p>
<div class="itemizedlist"><ul type="disc"><li><p>ClearCase build auditing, configuration lookup, and wink-in are not performed during builds on such hosts.<a name="idch5build61"></a></p>
</li>
<li><p>Files produced by such builds are not derived objects, and have no configuration records. (Users can employ remote-shell techniques to overcome this limitation, so that the files built on a non-ClearCase host <a name="idch5build62"></a><span class="emphasis"><i>do</i></span> become derived objects.)</p>
</li>
<li><p>Users cannot execute ClearCase development commands, such as <i>checkout</i> and <i>checkin</i>, on non-ClearCase hosts. (But they can probably remote-login to a ClearCase host for such purposes.)</p>
</li>
<li><p>Users cannot change the VOB image, by reconfiguring the view, from non-ClearCase hosts. (Again, a remote-login capability addresses this issue.)</p>
</li>
</ul></div></div></div><div class="section"><div class="titlepage"><div><h2 class="title"><a name="id5447523"></a>Derived Objects as Versions of Elements</h2></div></div>
<p>A typical software system is constructed hierarchically. For example, executables are built only after programming libraries have been built. With ClearCase, stable versions of libraries and other subtargets can be stored as versions of elements. At build time, the subtarget can be used essentially as a source file, instead of (potentially) being rebuilt. Derived objects that have become versions of elements are termed <a name="idch5build63"></a><i>DO versions</i>.</p>
<p>A development group can use DO versions to make its &#8220;product&#8221; (for example, a library) available to other groups. Typically, the group establishes a &#8220;release area&#8221; in a separate VOB. For example:</p>
<div class="itemizedlist"><ul type="disc"><li><p>A library is built by its development group in one location &#8212; perhaps <tt>/vobs/monet/lib/libmonet.a</tt>.</p>
</li>
<li><p>The group periodically &#8220;releases&#8221; the library by creating a new version of a publicly-accessible element &#8212; perhaps <tt>/vobs/publib/libmonet.a</tt>.</p>
</li>
</ul></div><div class="section"><div class="titlepage"><div><h3 class="title"><a name="id5447642"></a>Product Releases</h3></div></div>
<p>It is easy to generalize the idea of maintaining a <a name="idch5build64"></a><span class="emphasis"><i>development</i></span> release area to maintaining a <span class="emphasis"><i>product</i></span> release area. For example, a Release Engineering group might maintain one or more &#8220;release tree&#8221; VOBs. The directory structure of the tree(s) mirrors the hierarchy of files to be created on the release medium. (Since a release tree involves directory elements, it is easy to change its structure from release to release.) A release tree might be used to organize &#8220;Release 2.4.3&#8221; as follows:</p>
<div class="itemizedlist"><ul type="disc"><li><p>When an executable or other file is ready to be released, a release engineer checks it in as a version of an element in the release tree.</p>
</li>
<li><p>An appropriate version label (for example, <tt>REL2.4.3</tt>) is attached to that version, either manually by the engineer or automatically with a trigger.</p>
</li>
<li><p>When all files to be shipped have been released in this way, a release engineer configures a view to select <span class="emphasis"><i>only</i></span> versions with that version label. As seen through this view, the release tree contains exactly the set of files to be released.</p>
</li>
<li><p>To cut a release tape, the engineer issues a command to copy the appropriately configured release tree.</p>
</li>
</ul></div></div></div></div><!--CONTENT_END--><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04.html" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch04.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/index.html">Table of Contents</a></td><td width="40%" align="right"> <a accesskey="n" href="ch06.html" tppabs="http://techpubs.sgi.com/library/dynaweb_docs/0620/SGI_Developer/books/ClrC_CG/sgi_html/ch06.html">Next</a></td></tr><tr><td width="40%" align="left">Chapter 4. ClearCase Views </td><td width="20%" align="center"> </td><td width="40%" align="right">Chapter 6. ClearCase Process Control </td></tr></table></div></body></html>
